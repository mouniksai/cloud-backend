// prisma/schema.prisma
// PostgreSQL stores ONLY user identity & authentication data.
// All other data (elections, candidates, votes, audit logs) is stored on the Blockchain.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// 1. GOVERNMENT CITIZEN REGISTRY
model GovtRegistry {
  citizenId    String   @id @unique @map("citizen_id")
  fullName     String   @map("full_name")
  constituency String   @default("General")
  ward         String   @default("Ward A")
  dob          DateTime @db.Date
  gender       String?
  email        String   @unique
  mobile       String   @unique
  photoUrl     String?  @map("photo_url")
  isRegistered Boolean  @default(false) @map("is_registered")

  User User?
  @@map("govt_registry")
}

// 2. USER AUTHENTICATION & IDENTITY
model User {
  userId       String   @id @default(uuid()) @map("user_id") @db.Uuid
  username     String   @unique
  passwordHash String   @map("password_hash")
  role         String   @default("voter")
  
  // OTP fields for 2FA
  otpCode      String?  @map("otp_code")
  otpExpiresAt DateTime? @map("otp_expires_at")
  
  citizenId    String       @unique @map("citizen_id")
  citizen      GovtRegistry @relation(fields: [citizenId], references: [citizenId])

  @@map("users")
}

// ============================================================
// REMOVED FROM POSTGRESQL - NOW ON BLOCKCHAIN:
// - Election (elections are created and stored on the blockchain)
// - Candidate (candidates are added to blockchain blocks)
// - Vote (votes are cast and recorded as blockchain transactions)
// - AuditLog (audit entries are blockchain transactions)
// ============================================================